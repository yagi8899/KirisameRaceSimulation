# 穴馬分類器 特徴量提案書 📋

**作成日**: 2026年1月20日  
**ベース資料**: [ANAUME_ANALYSIS_REPORT.md](ANAUME_ANALYSIS_REPORT.md)  
**目的**: 穴馬（7-12番人気）の3着以内予測精度向上のための特徴量案

---

## 目次

1. [分析サマリー](#1-分析サマリー)
2. [リーク防止ガイドライン](#2-リーク防止ガイドライン)
3. [特徴量提案一覧](#3-特徴量提案一覧)
   - [3.1 競馬場関連](#31-競馬場関連)
   - [3.2 路面・距離関連](#32-路面距離関連)
   - [3.3 馬場状態関連](#33-馬場状態関連)
   - [3.4 クラス関連](#34-クラス関連)
   - [3.5 馬齢・性別関連](#35-馬齢性別関連)
   - [3.6 前走成績関連](#36-前走成績関連)
   - [3.7 騎手関連](#37-騎手関連)
   - [3.8 調教師関連](#38-調教師関連)
   - [3.9 複合特徴量](#39-複合特徴量)
4. [実装優先度マトリクス](#4-実装優先度マトリクス)
5. [実装時の注意事項](#5-実装時の注意事項)

---

## 1. 分析サマリー

ANAUME_ANALYSIS_REPORT.mdの分析結果から、以下の要因が穴馬の3着以内率に影響することが判明:

| 要因 | 影響度 | 穴馬有利条件 | 穴馬不利条件 |
|------|--------|--------------|--------------|
| **競馬場** | ★★★★★ | 福島(10.96%), 函館(10.87%), 小倉(10.84%) | 東京(9.25%) |
| **馬場状態** | ★★★★★ | 芝・不良(12.73%), 芝・重(11.11%) | ダート全般(8.5-9.3%) |
| **路面×距離** | ★★★★☆ | 芝短距離(11.19%), 芝長距離(11.09%) | ダート短距離(8.55%) |
| **クラス** | ★★★★☆ | OP(11.76%), 3勝クラス(11.60%) | 未勝利(8.48%), G1(8.81%) |
| **馬齢** | ★★★☆☆ | 4歳(10.97%), 5歳(10.85%) | 8歳以上(6.48%) |
| **性別** | ★★★☆☆ | セン馬(10.5%), 牡馬(10.2%) | 牝馬(9.0%) |
| **前走着順** | ★★★★☆ | 前走3着以内(11.65%) | 前走10着以下(7.80%) |
| **騎手** | ★★★★☆ | 川田(17.42%), ルメール(15.17%) | - |
| **調教師** | ★★★☆☆ | 一部調教師で高率 | - |

**ベースライン**: 穴馬（7-12番人気）全体の3着以内率 = **9.38%**

---

## 2. リーク防止ガイドライン

### ⛔ 絶対に使用禁止（リーク確定）

| データ | 理由 |
|--------|------|
| 当該レースの単勝オッズ | 当日データ、予測対象と同時に確定 |
| 当該レースの人気順位 | 当日データ、予測対象と同時に確定 |
| 当該レースの着順・タイム | 結果データ（これを予測している） |
| 当該レースのコーナー通過順位 | 結果データ |
| 当該レースの上がり3F | 結果データ |

### ✅ 安全に使用可能

| データ | 理由 |
|--------|------|
| 競馬場コード | 事前に確定している条件 |
| 距離・コース | 事前に確定している条件 |
| 馬場状態 | 当日朝に発表されるが、予測時点で既知として扱う※ |
| 馬齢・性別 | 固定情報 |
| 斤量 | 出走表で事前公開 |
| 枠番・馬番 | 出走表で事前公開 |
| **前走以前**のオッズ・人気 | 過去の確定データ |
| **前走以前**の着順・タイム | 過去の確定データ |
| **前走以前**のコーナー通過順位 | 過去の確定データ |
| 騎手・調教師の過去成績 | 過去の確定データ |

※馬場状態は速報予測では当日朝のデータを使用。訓練時は実際の馬場状態を使用。

### ⚠️ 要注意（条件付きで使用可能）

| データ | 注意点 |
|--------|--------|
| 騎手変更フラグ | **前走と今回の騎手比較**はOK。当日の乗り替わり情報のみは使用可能 |
| クラス変更 | **前走のクラスと今回のクラス比較**はOK |

---

## 3. 特徴量提案一覧

### 3.1 競馬場関連

#### 3.1.1 `is_local_track` - ローカル競馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `keibajo_code IN ('01','02','03','10')` → 1, else 0 |
| **対象競馬場** | 札幌(01), 函館(02), 福島(03), 小倉(10) |
| **期待効果** | +1.47% (ローカル平均10.85% vs 全体9.38%) |
| **実装難易度** | ★☆☆☆☆ (超簡単) |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5 競馬場別分析 |

#### 3.1.2 `is_fukushima` - 福島競馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `keibajo_code = '03'` → 1, else 0 |
| **期待効果** | +1.58% (最も荒れやすい) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5 (福島10.96%) |

#### 3.1.3 `is_hakodate` - 函館競馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `keibajo_code = '02'` → 1, else 0 |
| **期待効果** | +1.49% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5 (函館10.87%) |

#### 3.1.4 `is_kokura` - 小倉競馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `keibajo_code = '10'` → 1, else 0 |
| **期待効果** | +1.46% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5 (小倉10.84%) |

#### 3.1.5 `is_sapporo` - 札幌競馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `keibajo_code = '01'` → 1, else 0 |
| **期待効果** | +1.33% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5 (札幌10.71%) |

#### 3.1.6 `is_tokyo` - 東京競馬場フラグ（負の影響）
| 項目 | 内容 |
|------|------|
| **計算方法** | `keibajo_code = '05'` → 1, else 0 |
| **期待効果** | -0.13% (最も堅い) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5 (東京9.25%) |
| **備考** | 穴馬に不利な条件として使用 |

#### 3.1.7 `track_upset_tendency` - 競馬場別穴馬傾向スコア
| 項目 | 内容 |
|------|------|
| **計算方法** | 競馬場ごとの穴馬3着以内率を正規化（0-1スケール） |
| **マッピング例** | 福島=1.0, 函館=0.95, 小倉=0.93, ..., 東京=0.0 |
| **期待効果** | 競馬場の連続的な影響を捉える |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§5の数値をそのまま活用 |

---

### 3.2 路面・距離関連

#### 3.2.1 `is_turf` - 芝コースフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `track_code BETWEEN '10' AND '22'` → 1, else 0 |
| **期待効果** | 芝は全体的にダートより荒れやすい |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6 |

#### 3.2.2 `is_turf_sprint` - 芝短距離フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND kyori <= 1400` → 1, else 0 |
| **期待効果** | +1.81% (芝短距離11.19%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.1 |

#### 3.2.3 `is_turf_mile` - 芝マイルフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND kyori BETWEEN 1401 AND 1800` → 1, else 0 |
| **期待効果** | +0.22% (芝マイル9.60%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.1 |

#### 3.2.4 `is_turf_middle` - 芝中距離フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND kyori BETWEEN 1801 AND 2400` → 1, else 0 |
| **期待効果** | +0.55% (芝中距離9.93%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.1 |

#### 3.2.5 `is_turf_long` - 芝長距離フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND kyori >= 2401` → 1, else 0 |
| **期待効果** | +1.71% (芝長距離11.09%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.1 |

#### 3.2.6 `is_dirt_sprint` - ダート短距離フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 0 AND kyori <= 1400` → 1, else 0 |
| **期待効果** | -0.83% (ダート短距離8.55%, 最も堅い) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.2 |
| **備考** | 穴馬に不利な条件として使用 |

#### 3.2.7 `is_dirt_mile` - ダートマイルフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 0 AND kyori BETWEEN 1401 AND 1800` → 1, else 0 |
| **期待効果** | 基準程度 (ダートマイル9.27%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.2 |

#### 3.2.8 `is_dirt_long` - ダート中長距離フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 0 AND kyori >= 1801` → 1, else 0 |
| **期待効果** | +0.5% (ダート中長距離9.85%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§6.2 |

#### 3.2.9 `distance_category` - 距離カテゴリ（連続値）
| 項目 | 内容 |
|------|------|
| **計算方法** | 短距離=1, マイル=2, 中距離=3, 長距離=4 |
| **期待効果** | 距離の順序関係を捉える |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |

---

### 3.3 馬場状態関連

#### 3.3.1 `is_turf_bad` - 芝道悪フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND babajotai_code IN ('3','4')` → 1, else 0 |
| **対象** | 重(3), 不良(4) |
| **期待効果** | +2.0% (芝重11.11%, 芝不良12.73%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし（当日朝に確定、予測時点で既知） |
| **根拠** | ANAUME分析§7 (最も影響大!) |

#### 3.3.2 `is_turf_heavy` - 芝重馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND babajotai_code = '3'` → 1, else 0 |
| **期待効果** | +1.73% (芝重11.11%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7.1 |

#### 3.3.3 `is_turf_bad_condition` - 芝不良馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND babajotai_code = '4'` → 1, else 0 |
| **期待効果** | +3.35% (芝不良12.73%, 最大効果!) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7.1 |

#### 3.3.4 `is_turf_good` - 芝良馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND babajotai_code = '1'` → 1, else 0 |
| **期待効果** | 基準 (芝良9.47%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7.1 |

#### 3.3.5 `is_turf_slightly_heavy` - 芝稍重フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 1 AND babajotai_code = '2'` → 1, else 0 |
| **期待効果** | +0.37% (芝稍重9.75%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7.1 |

#### 3.3.6 `is_dirt_good` - ダート良馬場フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 0 AND babajotai_code = '1'` → 1, else 0 |
| **期待効果** | -0.11% (ダート良9.27%, やや不利) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7.2 |

#### 3.3.7 `is_dirt_bad` - ダート道悪フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf = 0 AND babajotai_code IN ('3','4')` → 1, else 0 |
| **期待効果** | -0.75% (ダート重8.93%, 不良8.63%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7.2 |
| **備考** | ダートの道悪は穴馬に不利 |

#### 3.3.8 `baba_upset_score` - 馬場状態別穴馬スコア
| 項目 | 内容 |
|------|------|
| **計算方法** | 路面×馬場状態の組み合わせでスコア化（0-1スケール） |
| **マッピング例** | 芝不良=1.0, 芝重=0.8, ..., ダート不良=0.0 |
| **期待効果** | 馬場状態の連続的な影響を捉える |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§7の数値をそのまま活用 |

---

### 3.4 クラス関連

#### 3.4.1 `is_open_class` - オープンクラスフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `kyoso_joken_code = '999'` → 1, else 0 |
| **期待効果** | +2.38% (OP 11.76%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.2 `is_3win_class` - 3勝クラスフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `kyoso_joken_code = '016'` → 1, else 0 |
| **期待効果** | +2.22% (3勝クラス 11.60%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.3 `is_2win_class` - 2勝クラスフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `kyoso_joken_code = '010'` → 1, else 0 |
| **期待効果** | +1.72% (2勝クラス 11.10%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.4 `is_1win_class` - 1勝クラスフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `kyoso_joken_code = '005'` → 1, else 0 |
| **期待効果** | +0.59% (1勝クラス 9.97%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.5 `is_maiden` - 未勝利・新馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `kyoso_joken_code IN ('001','002')` → 1, else 0 |
| **期待効果** | -0.90% (未勝利 8.48%, 最も堅い) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |
| **備考** | 穴馬に不利な条件として使用 |

#### 3.4.6 `is_grade_race` - 重賞フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `grade_code IN ('A','B','C')` → 1, else 0 |
| **対象** | G1(A), G2(B), G3(C) |
| **期待効果** | G1=-0.57%, G2=+1.30%, G3=+1.97% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.7 `is_g1` - G1レースフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `grade_code = 'A'` → 1, else 0 |
| **期待効果** | -0.57% (G1 8.81%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |
| **備考** | G1は堅い傾向 |

#### 3.4.8 `is_g2` - G2レースフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `grade_code = 'B'` → 1, else 0 |
| **期待効果** | +1.30% (G2 10.68%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.9 `is_g3` - G3レースフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `grade_code = 'C'` → 1, else 0 |
| **期待効果** | +1.97% (G3 11.35%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8 |

#### 3.4.10 `class_level` - クラスレベル（連続値）
| 項目 | 内容 |
|------|------|
| **計算方法** | 新馬=0, 未勝利=1, 1勝=2, 2勝=3, 3勝=4, OP=5, G3=6, G2=7, G1=8 |
| **期待効果** | クラスの順序関係を捉える |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.4.11 `class_upset_score` - クラス別穴馬スコア
| 項目 | 内容 |
|------|------|
| **計算方法** | クラスごとの穴馬3着以内率を正規化（0-1スケール） |
| **マッピング例** | OP=1.0, 3勝=0.95, ..., 未勝利=0.0 |
| **期待効果** | クラスの連続的な影響を捉える |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§8の数値をそのまま活用 |

---

### 3.5 馬齢・性別関連

#### 3.5.1 `is_age_4` - 4歳馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 4` → 1, else 0 |
| **期待効果** | +1.59% (4歳 10.97%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.2 `is_age_5` - 5歳馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 5` → 1, else 0 |
| **期待効果** | +1.47% (5歳 10.85%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.3 `is_age_prime` - 最盛期フラグ（4-5歳）
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei IN (4, 5)` → 1, else 0 |
| **期待効果** | +1.5% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.4 `is_age_3` - 3歳馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 3` → 1, else 0 |
| **期待効果** | 基準程度 (3歳 9.32%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.5 `is_age_6` - 6歳馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 6` → 1, else 0 |
| **期待効果** | +0.87% (6歳 10.25%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.6 `is_age_7` - 7歳馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 7` → 1, else 0 |
| **期待効果** | -0.24% (7歳 9.14%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.7 `is_age_old` - 高齢馬フラグ（8歳以上）
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei >= 8` → 1, else 0 |
| **期待効果** | -2.90% (8歳以上 6.48%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |
| **備考** | 強い負の影響、穴馬に不利 |

#### 3.5.8 `is_male` - 牡馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `seibetsu_code = '1'` → 1, else 0 |
| **期待効果** | +0.8% (牡馬 10.2%程度) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.9 `is_female` - 牝馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `seibetsu_code = '2'` → 1, else 0 |
| **期待効果** | -0.4% (牝馬 9.0%程度) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |
| **備考** | 穴馬に若干不利 |

#### 3.5.10 `is_gelding` - セン馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `seibetsu_code = '3'` → 1, else 0 |
| **期待効果** | +1.1% (セン馬 10.5%程度) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9 |

#### 3.5.11 `is_male_4yo` - 4歳牡馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 4 AND seibetsu_code = '1'` → 1, else 0 |
| **期待効果** | +1.59% (4歳牡馬 10.97%) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9.2 |

#### 3.5.12 `is_gelding_4yo` - 4歳セン馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `barei = 4 AND seibetsu_code = '3'` → 1, else 0 |
| **期待効果** | +1.91% (4歳セン馬 11.29%, 最高!) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§9.2 |

#### 3.5.13 `age_upset_score` - 馬齢別穴馬スコア
| 項目 | 内容 |
|------|------|
| **計算方法** | 馬齢ごとの穴馬3着以内率を正規化（0-1スケール） |
| **マッピング例** | 4歳=1.0, 5歳=0.95, ..., 8歳以上=0.0 |
| **期待効果** | 馬齢の連続的な影響を捉える |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

---

### 3.6 前走成績関連

#### 3.6.1 `zenso_top3` - 前走3着以内フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(kakutei_chakujun) <= 3` → 1, else 0 |
| **期待効果** | +2.27% (前走3着以内 11.65%) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし（前走データ） |
| **根拠** | ANAUME分析§12 |

#### 3.6.2 `zenso_top6` - 前走6着以内フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(kakutei_chakujun) <= 6` → 1, else 0 |
| **期待効果** | +1.5% (前走4-6着 11.14%) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§12 |

#### 3.6.3 `zenso_poor` - 前走10着以下フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(kakutei_chakujun) >= 10` → 1, else 0 |
| **期待効果** | -1.58% (前走10着以下 7.80%) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§12 |
| **備考** | 穴馬に不利な条件 |

#### 3.6.4 `zenso_chakujun` - 前走着順（連続値）
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(kakutei_chakujun)` |
| **期待効果** | 着順の連続的な影響を捉える |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§12 |

#### 3.6.5 `zenso_ninki_gap` - 前走人気着順ギャップ ⭐Phase 3.5計画済み
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(tansho_ninkijun - kakutei_chakujun)` |
| **意味** | 正=人気より好走（実力>評価）、負=人気負け |
| **期待効果** | +10% (過小評価馬の検出) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし（前走の人気・着順） |
| **根拠** | PHASE_3.5_PLAN.md |

#### 3.6.6 `zenso_agari_rank` - 前走上がり順位 ⭐Phase 3.5計画済み
| 項目 | 内容 |
|------|------|
| **計算方法** | `RANK() OVER (PARTITION BY race ORDER BY kohan_3f) → LAG` |
| **意味** | 前走でのレース内上がり3F順位 |
| **期待効果** | +10% (隠れた実力の検出) |
| **実装難易度** | ★★★☆☆ (2段階処理) |
| **リーク** | ⭕ なし（前走データ） |
| **根拠** | PHASE_3.5_PLAN.md |

#### 3.6.7 `zenso_nigeba` - 前走逃げフラグ ⭐Phase 3.5計画済み
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(corner_1 = 1)` → 1, else 0 |
| **意味** | 前走で逃げていたか |
| **期待効果** | +5% (展開依存性の検出) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | PHASE_3.5_PLAN.md |

#### 3.6.8 `zenso_taihai` - 前走大敗フラグ ⭐Phase 3.5計画済み
| 項目 | 内容 |
|------|------|
| **計算方法** | `LAG(kakutei_chakujun > 10)` → 1, else 0 |
| **意味** | 前走で大敗していたか |
| **期待効果** | +5% (巻き返しパターンの検出) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | PHASE_3.5_PLAN.md |
| **備考** | `zenso_poor`と逆の観点（大敗後の巻き返し狙い） |

#### 3.6.9 `saikin_kaikakuritsu` - 直近3走改善率 ⭐Phase 3.5計画済み
| 項目 | 内容 |
|------|------|
| **計算方法** | `COUNT(今回着順 < 前回着順) / 3` |
| **意味** | 直近3走で着順が改善した割合 |
| **期待効果** | +8% (調子の上向き検出) |
| **実装難易度** | ★★★☆☆ (WINDOW関数) |
| **リーク** | ⭕ なし（過去走データのみ） |
| **根拠** | PHASE_3.5_PLAN.md |

#### 3.6.10 `zenso_class_up` - 前走からクラス昇級フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回クラス > LAG(クラス)` → 1, else 0 |
| **意味** | 前走からクラスが上がったか |
| **期待効果** | 昇級馬は人気になりにくいが実力あり |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.11 `zenso_class_down` - 前走からクラス降級フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回クラス < LAG(クラス)` → 1, else 0 |
| **意味** | 前走からクラスが下がったか |
| **期待効果** | 降級馬は有利だが人気になりやすいので微妙 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **備考** | Phase 3で削除された特徴量の再検討版 |

#### 3.6.12 `zenso_kyori_change` - 前走からの距離変化
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回距離 - LAG(距離)` |
| **意味** | 正=距離延長、負=距離短縮 |
| **期待効果** | 距離適性の観点 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.13 `zenso_kyori_extension` - 前走から距離延長フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回距離 > LAG(距離) + 200` → 1, else 0 |
| **期待効果** | 距離延長は穴馬に有利な場合あり |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.14 `zenso_kyori_shorten` - 前走から距離短縮フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回距離 < LAG(距離) - 200` → 1, else 0 |
| **期待効果** | 距離短縮の影響を検出 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.15 `zenso_track_change` - 前走から競馬場変更フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回競馬場 != LAG(競馬場)` → 1, else 0 |
| **期待効果** | 輸送の影響、コース適性変化 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.16 `zenso_surface_change` - 前走から芝ダ変更フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回路面 != LAG(路面)` → 1, else 0 |
| **期待効果** | 芝↔ダート転向の影響 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.17 `rest_days` - 前走からの休養日数
| 項目 | 内容 |
|------|------|
| **計算方法** | `今回日付 - LAG(日付)` |
| **意味** | 間隔が長いと調子不明で穴になりやすい？ |
| **期待効果** | 休み明けの影響を検出 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.18 `is_fresh` - 休み明けフラグ（3ヶ月以上）
| 項目 | 内容 |
|------|------|
| **計算方法** | `rest_days >= 90` → 1, else 0 |
| **期待効果** | 休み明けは人気落ちしやすいが好走もあり |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.6.19 `is_consecutive` - 連闘フラグ（2週以内）
| 項目 | 内容 |
|------|------|
| **計算方法** | `rest_days <= 14` → 1, else 0 |
| **期待効果** | 連闘の影響を検出 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

---

### 3.7 騎手関連

> **注意**: 騎手統計は集計期間・サンプル数の設定が重要。  
> **実装案**: DB上でマテリアライズドビュー（Materialized View）を作成し、  
> 定期的に更新することで計算コストを削減。

#### 3.7.1 `jockey_anaume_rate` - 騎手穴馬3着以内率
| 項目 | 内容 |
|------|------|
| **計算方法** | 騎手の過去N走（7-12番人気時）の3着以内率 |
| **集計期間案** | 過去3年 or 過去300走（どちらか多い方） |
| **期待効果** | +2% (川田17.42% vs 平均9.38%で約8%差) |
| **実装難易度** | ★★★★☆ (集計処理が必要) |
| **リーク** | ⭕ なし（過去データ） |
| **根拠** | ANAUME分析§10 |
| **DB実装案** | `CREATE MATERIALIZED VIEW jockey_anaume_stats AS ...` |

#### 3.7.2 `jockey_win_rate` - 騎手勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 騎手の過去N走の1着率 |
| **集計期間案** | 過去1年 or 過去200走 |
| **期待効果** | 一流騎手は穴馬でも勝たせる |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

#### 3.7.3 `jockey_rentai_rate` - 騎手連対率
| 項目 | 内容 |
|------|------|
| **計算方法** | 騎手の過去N走の2着以内率 |
| **集計期間案** | 過去1年 or 過去200走 |
| **期待効果** | 安定感のある騎手を検出 |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

#### 3.7.4 `jockey_fukusho_rate` - 騎手複勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 騎手の過去N走の3着以内率 |
| **集計期間案** | 過去1年 or 過去200走 |
| **期待効果** | 複勝圏内の安定感を検出 |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

#### 3.7.5 `jockey_track_win_rate` - 騎手×競馬場勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 騎手の当該競馬場での過去勝率 |
| **期待効果** | 競馬場相性を検出（ローカル得意騎手など） |
| **実装難易度** | ★★★★☆ |
| **リーク** | ⭕ なし |

#### 3.7.6 `jockey_distance_win_rate` - 騎手×距離勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 騎手の当該距離帯での過去勝率 |
| **期待効果** | 距離適性を検出（短距離得意騎手など） |
| **実装難易度** | ★★★★☆ |
| **リーク** | ⭕ なし |

#### 3.7.7 `is_top_jockey` - トップジョッキーフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | 年間リーディング上位10名 or 穴馬率TOP10 → 1, else 0 |
| **対象騎手例** | 川田、ルメール、福永、西村、戸崎、横山武、岩田望、松山、坂井、武豊 |
| **期待効果** | +3% |
| **実装難易度** | ★★☆☆☆ (リスト固定なら簡単) |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§10 |

#### 3.7.8 `jockey_recent_form` - 騎手直近調子
| 項目 | 内容 |
|------|------|
| **計算方法** | 直近10走の3着以内率 |
| **期待効果** | 調子の波を検出 |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

---

### 3.8 調教師関連

> **注意**: 調教師統計も騎手同様、マテリアライズドビューでの実装を推奨。

#### 3.8.1 `trainer_anaume_rate` - 調教師穴馬3着以内率
| 項目 | 内容 |
|------|------|
| **計算方法** | 調教師の過去N走（7-12番人気時）の3着以内率 |
| **集計期間案** | 過去3年 or 過去200走 |
| **期待効果** | +1% (TOP調教師で15%以上) |
| **実装難易度** | ★★★★☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§11 |
| **DB実装案** | `CREATE MATERIALIZED VIEW trainer_anaume_stats AS ...` |

#### 3.8.2 `trainer_win_rate` - 調教師勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 調教師の過去N走の1着率 |
| **期待効果** | 有力厩舎を検出 |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

#### 3.8.3 `trainer_fukusho_rate` - 調教師複勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 調教師の過去N走の3着以内率 |
| **期待効果** | 安定した厩舎を検出 |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

#### 3.8.4 `trainer_track_rate` - 調教師×競馬場勝率
| 項目 | 内容 |
|------|------|
| **計算方法** | 調教師の当該競馬場での過去勝率 |
| **期待効果** | ローカル得意厩舎などを検出 |
| **実装難易度** | ★★★★☆ |
| **リーク** | ⭕ なし |

#### 3.8.5 `is_top_trainer` - トップトレーナーフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | 穴馬3着以内率TOP20 → 1, else 0 |
| **対象調教師例** | 田中克典、辻野泰之、矢作芳人、手塚貴久など |
| **期待効果** | +1% |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |
| **根拠** | ANAUME分析§11 |

#### 3.8.6 `trainer_recent_form` - 調教師直近調子
| 項目 | 内容 |
|------|------|
| **計算方法** | 直近20走の3着以内率 |
| **期待効果** | 厩舎の調子の波を検出 |
| **実装難易度** | ★★★☆☆ |
| **リーク** | ⭕ なし |

---

### 3.9 複合特徴量

> ⚠️ **LightGBM使用時の注意**: LightGBMは決定木の分岐で交互作用を自動検出するため、2要素の複合特徴量は**基本的に不要**。  
> 3要素以上の複雑な交互作用や、非線形計算(割り算・掛け算)のみ手動追加を検討。  
> **Phase 1-2実装後にSHAP Interaction Valuesで交互作用を確認してから判断すること。**

#### 3.9.1 `local_turf_bad` - ローカル×芝道悪フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_local_track = 1 AND is_turf_bad = 1` → 1, else 0 |
| **期待効果** | +0-1% (LightGBMが自動学習する可能性高) |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |
| **備考** | Phase 1-2実装後にSHAP分析で交互作用不足なら追加検討 |

#### 3.9.2 `local_turf_sprint` - ローカル×芝短距離フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_local_track = 1 AND is_turf_sprint = 1` → 1, else 0 |
| **期待効果** | +3% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.9.3 `prime_age_male` - 最盛期牡馬フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_age_prime = 1 AND is_male = 1` → 1, else 0 |
| **期待効果** | +2% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.9.4 `zenso_good_class_up` - 前走好走×クラス昇級フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `zenso_top3 = 1 AND zenso_class_up = 1` → 1, else 0 |
| **意味** | 前走好走で昇級してきた馬（実力あり） |
| **期待効果** | +3% |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.9.5 `turf_bad_prime_age` - 芝道悪×最盛期フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_turf_bad = 1 AND is_age_prime = 1` → 1, else 0 |
| **期待効果** | +3.5% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.9.6 `open_class_local` - オープン×ローカルフラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_open_class = 1 AND is_local_track = 1` → 1, else 0 |
| **期待効果** | +4% |
| **実装難易度** | ★☆☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.9.7 `top_jockey_anaume` - トップ騎手×穴馬条件フラグ
| 項目 | 内容 |
|------|------|
| **計算方法** | `is_top_jockey = 1` (穴馬予測時のみ有効) |
| **期待効果** | +5% (川田などが穴馬騎乗時) |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

#### 3.9.8 `upset_condition_score` - 穴馬有利条件総合スコア
| 項目 | 内容 |
|------|------|
| **計算方法** | 各フラグの加重平均（下記参照） |
| **重み例** | `is_local_track*1.5 + is_turf_bad*2.5 + is_age_prime*1.5 + ...` |
| **期待効果** | 複合条件の影響を一つのスコアで表現 |
| **実装難易度** | ★★☆☆☆ |
| **リーク** | ⭕ なし |

---

## 4. 実装優先度マトリクス

### Phase 1: 即効性が高い（1週間以内） - 目標Precision 6.20%→9-11%

| 優先度 | 特徴量 | 期待効果 | 実装難易度 | ステータス |
|--------|--------|----------|------------|------------|
| 🥇1 | `is_turf_bad_condition` (芝不良) | +3.35% | ★☆☆☆☆ | ⚪未実装 |
| 🥇1 | `is_turf_heavy` (芝重) | +1.73% | ★☆☆☆☆ | ⚪未実装 |
| 🥈2 | `is_local_track` | +1.47% | ★☆☆☆☆ | ⚪未実装 |
| 🥈2 | `is_open_class` | +2.38% | ★☆☆☆☆ | ⚪未実装 |
| 🥈2 | `is_3win_class` | +2.22% | ★☆☆☆☆ | ⚪未実装 |
| 🥉3 | `is_age_prime` (4-5歳) | +1.50% | ★☆☆☆☆ | ⚪未実装 |
| 🥉3 | `zenso_top6` | +1.82% | ★★☆☆☆ | ⚪未実装 |
| 🥉3 | `rest_days_fresh` (1-3週) | +0.5% | ★★☆☆☆ | ⚪未実装 |

**合計期待効果**: +14.5% → 実際は特徴量間の相関を考慮して**+3-5%の改善**を見込む  
**Precision目標**: 6.20% → 9-11%

### Phase 2: 中程度の効果（2週間以内）

⭐ = Phase 3.5.1実装済み（効果+0.91%確認済み）

| 優先度 | 特徴量 | 期待効果 | 実装難易度 | ステータス |
|--------|--------|----------|------------|------------|
| 4 | `zenso_ninki_gap` ⭐ | +10%期待→実測+0.91% | ★★☆☆☆ | ✅実装済み |
| 4 | `zenso_agari_rank` ⭐ | +10%期待→実測込み | ★★★☆☆ | ✅実装済み |
| 4 | `saikin_kaikakuritsu` ⭐ | +8%期待→実測込み | ★★★☆☆ | ✅実装済み |
| 4 | `zenso_class_up` | +1.5% | ★★☆☆☆ | ⚪未実装 |
| 4 | `zenso_distance_change` | +1% | ★★☆☆☆ | ⚪未実装 |
| 5 | `zenso_surface_change` | +1% | ★★☆☆☆ | ⚪未実装 |
| 5 | `is_age_old` (負の影響) | -2.9% | ★☆☆☆☆ | ⚪未実装 |
| 5 | `zenso_poor` (負の影響) | -1.58% | ★★☆☆☆ | ⚪未実装 |
| 5 | `is_maiden` (負の影響) | -0.9% | ★☆☆☆☆ | ⚪未実装 |
| 6 | `baba_upset_score` | +1% | ★★☆☆☆ | ⚪未実装 |
| 6 | `track_upset_tendency` | +1% | ★★☆☆☆ | ⚪未実装 |
| 6 | `class_upset_score` | +1% | ★★☆☆☆ | ⚪未実装 |

### Phase 3: 騎手・調教師統計（1ヶ月以内）

| 優先度 | 特徴量 | 期待効果 | 実装難易度 |
|--------|--------|----------|------------|
| 7 | `jockey_anaume_rate` | +2% | ★★★★☆ |
| 7 | `is_top_jockey` | +3% | ★★☆☆☆ |
| 8 | `trainer_anaume_rate` | +1% | ★★★★☆ |
| 8 | `is_top_trainer` | +1% | ★★☆☆☆ |

### Phase 4: 複合特徴量（SHAP分析後に判断）

⚠️ **LightGBMは2要素の交互作用を自動学習するため、Phase 4は基本的に不要。**  
**Phase 1-2実装後、SHAP Interaction Valuesで交互作用の学習状況を確認してから判断すること。**

| 優先度 | 特徴量 | 期待効果 | 実装難易度 | 備考 |
|--------|--------|----------|------------|------|
| 9 | `upset_condition_score` | +1-2% | ★★☆☆☆ | 加重平均スコアは非線形なので効果あるかも |
| 10 | `local_turf_bad` | +0-1% | ★☆☆☆☆ | 自動学習される可能性高、SHAP確認後に判断 |
| 10 | その他2要素複合 | +0-1% | ★☆☆☆☆ | 基本的に不要 |

---

## 5. 実装時の注意事項

### 5.1 リーク防止チェックリスト

実装時に必ず確認:

- [ ] 当該レースのオッズ・人気を使用していないか
- [ ] 当該レースの結果（着順・タイム）を使用していないか
- [ ] `LAG()`を使用する場合、正しく前走データを参照しているか
- [ ] 騎手・調教師統計は過去データのみで計算しているか

### 5.2 SQL実装のベストプラクティス

```sql
-- 前走データの取得例（リーク安全）
LAG(kakutei_chakujun, 1) OVER (
    PARTITION BY ketto_toroku_bango 
    ORDER BY kaisai_nen, kaisai_tsukihi, race_bango
) AS zenso_chakujun
```

### 5.3 騎手・調教師統計のDB View実装案

```sql
-- 騎手穴馬統計用マテリアライズドビュー
CREATE MATERIALIZED VIEW jockey_anaume_stats AS
SELECT 
    kishu_code,
    COUNT(*) AS anaume_rides,
    SUM(CASE WHEN kakutei_chakujun <= 3 THEN 1 ELSE 0 END) AS anaume_top3,
    SUM(CASE WHEN kakutei_chakujun <= 3 THEN 1 ELSE 0 END)::float 
        / NULLIF(COUNT(*), 0) AS anaume_rate
FROM jvd_se
WHERE tansho_ninkijun BETWEEN 7 AND 12
  AND kaisai_nen >= EXTRACT(YEAR FROM CURRENT_DATE) - 3
GROUP BY kishu_code
HAVING COUNT(*) >= 30;  -- 最低サンプル数

-- 定期更新（毎週月曜など）
REFRESH MATERIALIZED VIEW jockey_anaume_stats;
```

### 5.4 特徴量の相関チェック

実装後は以下を確認:
- 類似特徴量間の相関（例: `is_turf_bad` と `is_turf_heavy`）
- 多重共線性の確認
- 不要な特徴量の削除検討

### 5.5 効果検証の方法

1. **単体効果**: 特徴量追加前後のPrecision/Recallを比較
2. **SHAP値確認**: 特徴量重要度が期待通りか
3. **A/Bテスト**: Walk-Forward Validationで時系列的な効果を検証

---

## 付録: 特徴量数サマリー

| カテゴリ | 特徴量数 |
|----------|----------|
| 競馬場関連 | 7 |
| 路面・距離関連 | 9 |
| 馬場状態関連 | 8 |
| クラス関連 | 11 |
| 馬齢・性別関連 | 13 |
| 前走成績関連 | 19 |
| 騎手関連 | 8 |
| 調教師関連 | 6 |
| 複合特徴量 | 8 |
| **合計** | **89** |

※全て実装する必要はなく、Phase 1-2の高優先度特徴量から順に効果検証しながら追加することを推奨。

---

**次のアクション**:
1. Phase 1の特徴量10個を`db_query_builder.py`に実装
2. モデル再訓練・評価
3. SHAP分析で効果検証
4. Phase 2以降を順次実装
